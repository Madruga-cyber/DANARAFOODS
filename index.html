<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DANARAFOODS - Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }
        #app-loader { display: flex; }
        /* Hide scrollbar for categories */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- App Loader -->
    <div id="app-loader" class="fixed inset-0 bg-white z-[100] flex flex-col items-center justify-center">
        <h1 class="text-3xl font-bold text-orange-500 mb-4">DANARAFOODS</h1>
        <svg class="animate-spin h-8 w-8 text-orange-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
    </div>

    <div id="app" class="hidden">

        <!-- Header -->
        <header class="bg-white/80 backdrop-blur-md shadow-sm fixed top-0 left-0 right-0 z-40">
            <div class="container mx-auto px-4 py-2 flex justify-between items-center max-w-7xl">
                <button id="home-button" class="cursor-pointer">
                     <div id="logo-container" class="h-14 flex items-center">
                        <h1 id="header-text-logo" class="text-3xl font-bold text-orange-500">DANARAFOODS</h1>
                        <img id="header-image-logo" class="hidden h-full w-auto object-contain" alt="Logo DANARAFOODS">
                    </div>
                </button>
                <div class="flex items-center space-x-4">
                    <button id="cart-button" class="relative">
                        <i data-lucide="shopping-cart" class="text-gray-600"></i>
                        <span id="cart-count" class="absolute -top-2 -right-2 bg-orange-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-semibold">0</span>
                    </button>
                    <button id="admin-nav-button">
                        <i data-lucide="settings" class="text-gray-600"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section id="hero" class="relative h-[60vh] sm:h-[80vh] flex items-center justify-center text-center overflow-hidden">
            <video autoplay loop muted playsinline class="absolute top-0 left-0 w-full h-full object-cover z-0">
                <source src="https://firebasestorage.googleapis.com/v0/b/danarafoods.firebasestorage.app/o/FOTOS%20E%20VIDEOS%2F202509161319.mp4?alt=media&token=375aebec-43a8-41eb-83a9-17f2da8c7cf0" type="video/mp4">
                Seu navegador não suporta vídeos.
            </video>
            <div class="absolute top-0 left-0 w-full h-full bg-black/60 z-10"></div>
            <div class="relative z-20 px-4 text-white animate-fade-in flex flex-col items-center">
                <img id="hero-logo-image" class="h-24 md:h-32 mt-12 sm:mt-0 mb-8 hidden object-contain" alt="Logo DANARAFOODS">
                <h2 class="text-4xl md:text-6xl font-bold tracking-tight mb-4">Escolha seu salgado ou doce Favorito.</h2>
                <p class="text-lg md:text-xl max-w-2xl mx-auto mb-8">Aproveite nosso Cardápio! Escolha o que desejar e receba em sua casa de forma rápida e segura.</p>
                <a href="#menu-section" class="bg-orange-500 text-white font-bold py-3 px-8 rounded-full text-lg hover:bg-orange-600 transition-transform hover:scale-105 inline-block">
                    Ver Cardápio Agora
                </a>
            </div>
        </section>

        <main class="container mx-auto">
            <!-- Info Sections -->
            <section id="info-services-view" class="py-16 px-4 bg-white">
                 <div class="text-center max-w-4xl mx-auto">
                    <h2 class="text-sm font-bold text-orange-500 uppercase tracking-wider">Serviços</h2>
                    <p class="text-3xl md:text-4xl font-bold mt-2 mb-12">Como são nossos serviços?</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                    <div class="text-center p-6 bg-gray-50 rounded-lg">
                        <div class="inline-block p-4 bg-orange-100 rounded-full mb-4">
                             <i data-lucide="smartphone" class="w-8 h-8 text-orange-500"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Fácil de pedir</h3>
                        <p class="text-gray-600">Você só precisa de alguns passos para pedir seu salgado ou doce.</p>
                    </div>
                     <div class="text-center p-6 bg-gray-50 rounded-lg">
                        <div class="inline-block p-4 bg-orange-100 rounded-full mb-4">
                             <i data-lucide="truck" class="w-8 h-8 text-orange-500"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Entrega rápida</h3>
                        <p class="text-gray-600">Nossa entrega é sempre pontual, rápida e segura.</p>
                    </div>
                     <div class="text-center p-6 bg-gray-50 rounded-lg">
                        <div class="inline-block p-4 bg-orange-100 rounded-full mb-4">
                            <i data-lucide="gem" class="w-8 h-8 text-orange-500"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Melhor Qualidade</h3>
                        <p class="text-gray-600">Não só a rapidez na entrega, a qualidade também é o nosso forte.</p>
                    </div>
                </div>
            </section>

             <section id="info-payments-view" class="py-16 px-4">
                 <div class="text-center max-w-4xl mx-auto">
                    <h2 class="text-sm font-bold text-orange-500 uppercase tracking-wider">Pagamentos</h2>
                    <p class="text-3xl md:text-4xl font-bold mt-2 mb-12">Formas de Pagamento</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                    <div class="p-6 bg-white rounded-lg shadow-sm border">
                        <i data-lucide="credit-card" class="w-8 h-8 text-orange-500 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Cartão de Crédito/Débito</h3>
                        <p class="text-gray-600">Visa, Mastercard, Elo.</p>
                    </div>
                     <div class="p-6 bg-white rounded-lg shadow-sm border">
                         <i data-lucide="send" class="w-8 h-8 text-orange-500 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">PIX</h3>
                        <p class="text-gray-600">Pagamento instantâneo.</p>
                    </div>
                     <div class="p-6 bg-white rounded-lg shadow-sm border">
                        <i data-lucide="dollar-sign" class="w-8 h-8 text-orange-500 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Dinheiro na Entrega</h3>
                        <p class="text-gray-600">Pagamento em espécie com troco.</p>
                    </div>
                </div>
            </section>

            <!-- Main Menu View -->
            <section id="menu-section" class="pt-16 pb-24 px-4 bg-gray-50">
                <div id="menu-view" class="animate-fade-in">
                    <h2 class="text-3xl font-bold mb-2 text-center">Nosso Cardápio</h2>
                    <p class="text-gray-500 mb-6 text-center">Escolha seus produtos favoritos e adicione ao carrinho.</p>
                    <div id="categories" class="flex items-center space-x-3 mb-8 overflow-x-auto pb-4 no-scrollbar -mx-4 px-4">
                        <!-- Categories will be rendered here -->
                    </div>
                    <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
                </div>
            </section>
            
             <!-- Admin View -->
            <div id="admin-view" class="hidden animate-fade-in p-4">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">Painel de Administração</h2>
                    <button id="menu-nav-button" class="bg-orange-500 text-white px-4 py-2 rounded-lg font-semibold flex items-center space-x-2 hover:bg-orange-600 transition">
                        <i data-lucide="book-open"></i>
                        <span>Ver Cardápio</span>
                    </button>
                </div>

                <!-- General Settings -->
                <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-xl font-bold mb-4">Configurações Gerais</h3>
                    <form id="settings-form">
                         <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                            <div class="md:col-span-2">
                                <label for="delivery-fee" class="block text-sm font-medium text-gray-700">Taxa de Entrega (R$)</label>
                                <input type="number" step="0.01" id="delivery-fee" placeholder="Ex: 5.00" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3">
                            </div>
                            <div>
                                 <button type="submit" id="save-settings-button" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition">Salvar Taxa</button>
                            </div>
                        </div>
                    </form>
                    <div class="border-t mt-6 pt-6">
                        <h4 class="text-lg font-semibold mb-2">Logo da Loja</h4>
                        <div class="flex items-center gap-4">
                            <img id="logo-preview" class="w-20 h-20 object-contain rounded-md bg-gray-100" src="https://placehold.co/100x100/f97316/ffffff?text=Logo" alt="Pré-visualização da logo">
                            <div>
                                <label for="logo-upload" class="block text-sm font-medium text-gray-700">Carregar nova logo</label>
                                <input type="file" id="logo-upload" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100">
                                <button id="save-logo-button" class="mt-2 bg-blue-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-600 transition text-sm">Salvar Logo</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Category Management -->
                <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-xl font-bold mb-4">Gerenciar Categorias</h3>
                    <form id="category-form" class="flex gap-4 items-end mb-4">
                        <div class="flex-grow">
                            <label for="category-name" class="block text-sm font-medium text-gray-700">Nova Categoria</label>
                            <input type="text" id="category-name" placeholder="Ex: Especiais" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3">
                        </div>
                        <button type="submit" class="bg-green-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-600 transition">Adicionar</button>
                    </form>
                    <div id="admin-category-list" class="space-y-2">
                        <!-- Admin categories will be rendered here -->
                    </div>
                </div>

                <!-- Add/Edit Product Form -->
                <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h3 id="form-title" class="text-xl font-bold mb-4">Adicionar Novo Produto</h3>
                    <form id="product-form" class="space-y-4">
                        <input type="hidden" id="product-id">
                        <div>
                            <label for="product-name" class="block text-sm font-medium text-gray-700">Nome</label>
                            <input type="text" id="product-name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3">
                        </div>
                        <div>
                            <label for="product-description" class="block text-sm font-medium text-gray-700">Descrição</label>
                            <textarea id="product-description" rows="2" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3"></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="product-price" class="block text-sm font-medium text-gray-700">Preço (R$)</label>
                                <input type="number" step="0.01" id="product-price" placeholder="Ex: 3.50" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3">
                            </div>
                            <div>
                                <label for="product-category" class="block text-sm font-medium text-gray-700">Categoria</label>
                                <select id="product-category" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3">
                                    <!-- Category options will be rendered here -->
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="product-image" class="block text-sm font-medium text-gray-700">Imagem</label>
                            <input type="file" id="product-image" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100">
                             <input type="hidden" id="product-image-url">
                            <img id="image-preview" class="mt-4 rounded-lg max-h-40 object-contain hidden" src="" alt="Pré-visualização da imagem">
                        </div>
                        <div class="flex space-x-4">
                            <button type="submit" id="save-product-button" class="w-full bg-orange-500 text-white py-3 rounded-lg font-semibold hover:bg-orange-600 transition flex items-center justify-center gap-2">
                                <span id="save-product-text">Salvar Produto</span>
                                <svg id="save-product-loader" class="animate-spin h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                            </button>
                            <button type="button" id="cancel-edit-button" class="w-full bg-gray-200 text-gray-800 py-3 rounded-lg font-semibold hover:bg-gray-300 transition hidden">Cancelar Edição</button>
                        </div>
                    </form>
                </div>

                <!-- Product List for Admin -->
                <div id="admin-product-list" class="space-y-4"></div>
            </div>

            <!-- Checkout View -->
            <div id="checkout-view" class="hidden animate-fade-in p-4">
                 <h2 class="text-3xl font-bold mb-6">Finalizar Pedido</h2>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-bold mb-4">Endereço de Entrega</h3>
                            <form id="checkout-form" class="space-y-4">
                                <div>
                                    <label for="customer-name" class="block text-sm font-medium text-gray-700">Nome Completo</label>
                                    <input type="text" id="customer-name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3" placeholder="Seu nome e sobrenome">
                                </div>
                                <div>
                                    <label for="customer-phone" class="block text-sm font-medium text-gray-700">Telefone (WhatsApp)</label>
                                    <input type="tel" id="customer-phone" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3" placeholder="(00) 00000-0000">
                                </div>
                                 <div>
                                    <label for="customer-cep" class="block text-sm font-medium text-gray-700">CEP</label>
                                    <div class="relative">
                                        <input type="tel" id="customer-cep" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3" placeholder="Apenas números">
                                        <div id="cep-loader" class="absolute inset-y-0 right-0 flex items-center pr-3 hidden">
                                            <svg class="animate-spin h-5 w-5 text-orange-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="md:col-span-2">
                                        <label for="customer-street" class="block text-sm font-medium text-gray-700">Rua / Logradouro</label>
                                        <input type="text" id="customer-street" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3 bg-gray-100" readonly>
                                    </div>
                                    <div>
                                        <label for="customer-number" class="block text-sm font-medium text-gray-700">Número</label>
                                        <input type="text" id="customer-number" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3">
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="customer-neighborhood" class="block text-sm font-medium text-gray-700">Bairro</label>
                                        <input type="text" id="customer-neighborhood" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3 bg-gray-100" readonly>
                                    </div>
                                    <div>
                                        <label for="customer-complement" class="block text-sm font-medium text-gray-700">Complemento (Opcional)</label>
                                        <input type="text" id="customer-complement" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3">
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="md:col-span-2">
                                        <label for="customer-city" class="block text-sm font-medium text-gray-700">Cidade</label>
                                        <input type="text" id="customer-city" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3 bg-gray-100" readonly>
                                    </div>
                                    <div>
                                        <label for="customer-state" class="block text-sm font-medium text-gray-700">Estado</label>
                                        <input type="text" id="customer-state" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3 bg-gray-100" readonly>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold mb-4 mt-6">Forma de Pagamento</h3>
                                    <div id="payment-method" class="space-y-2">
                                        <div>
                                            <label class="flex items-center p-4 border rounded-lg cursor-pointer has-[:checked]:bg-orange-50 has-[:checked]:border-orange-500">
                                                <input type="radio" name="payment" value="Dinheiro" class="h-5 w-5 text-orange-600 focus:ring-orange-500" checked>
                                                <span class="ml-3 font-medium">Dinheiro</span>
                                            </label>
                                            <div id="change-container" class="p-4 border-l border-r border-b rounded-b-lg -mt-2 bg-gray-50">
                                                 <label for="change-for" class="block text-sm font-medium text-gray-700">Precisa de troco?</label>
                                                 <input type="number" step="0.01" id="change-for" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 text-lg p-3" placeholder="Pagar com R$ (opcional)">
                                            </div>
                                        </div>
                                        <label class="flex items-center p-4 border rounded-lg cursor-pointer has-[:checked]:bg-orange-50 has-[:checked]:border-orange-500">
                                            <input type="radio" name="payment" value="Cartão" class="h-5 w-5 text-orange-600 focus:ring-orange-500">
                                            <span class="ml-3 font-medium">Cartão de Crédito/Débito</span>
                                        </label>
                                        <label class="flex items-center p-4 border rounded-lg cursor-pointer has-[:checked]:bg-orange-50 has-[:checked]:border-orange-500">
                                            <input type="radio" name="payment" value="Pix" class="h-5 w-5 text-orange-600 focus:ring-orange-500">
                                            <span class="ml-3 font-medium">Pix</span>
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div>
                        <div class="bg-white p-6 rounded-lg shadow-md sticky top-24">
                            <h3 class="text-xl font-bold mb-4">Resumo do Pedido</h3>
                            <div id="checkout-summary" class="text-gray-600"></div>
                            <div class="border-t my-4"></div>
                            <div class="flex justify-between font-bold text-lg">
                                <span>Total:</span>
                                <span id="checkout-total">R$ 0,00</span>
                            </div>
                            <button id="place-order-button" class="w-full mt-6 bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition">Confirmar Pedido</button>
                            <button id="back-to-menu-button" class="w-full mt-2 bg-gray-200 text-gray-800 py-3 rounded-lg font-semibold hover:bg-gray-300 transition">Voltar ao Cardápio</button>
                        </div>
                    </div>
                </div>
            </div>
             <!-- Order Confirmation View -->
            <div id="order-confirmation-view" class="hidden animate-fade-in text-center bg-white p-8 rounded-lg shadow-lg max-w-lg mx-auto my-10">
                <i data-lucide="check-circle" class="text-green-500 w-24 h-24 mx-auto mb-4"></i>
                <h2 class="text-3xl font-bold mb-2">Pedido Recebido!</h2>
                <p class="text-gray-600 mb-6">Sua mensagem foi enviada. Agradecemos a sua preferência!</p>
                <div class="text-left bg-gray-50 p-4 rounded-lg mb-6">
                     <h3 class="font-bold text-lg mb-3 border-b pb-2">Detalhes do Pedido</h3>
                     <div id="confirmation-details"></div>
                </div>
                <button id="new-order-button" class="w-full bg-orange-500 text-white py-3 rounded-lg font-semibold hover:bg-orange-600 transition">Fazer Novo Pedido</button>
            </div>

        </main>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full">
            <h3 id="confirmation-title" class="text-lg font-bold mb-4">Confirmar Exclusão</h3>
            <p id="confirmation-message" class="text-gray-600 mb-6">Tem certeza que deseja excluir este produto?</p>
            <div class="flex justify-end space-x-4">
                <button id="cancel-confirmation-button" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 transition">Cancelar</button>
                <button id="confirm-action-button" class="bg-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-600 transition">Excluir</button>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 invisible opacity-0 transition-opacity duration-300 ease-in-out">
        <div class="bg-white w-full max-w-md h-full flex flex-col shadow-xl absolute right-0 transform translate-x-full transition-transform duration-300 ease-in-out">
            <div class="p-4 flex justify-between items-center border-b">
                <h2 class="text-xl font-bold">Meu Carrinho</h2>
                <button id="close-cart-button" class="p-2 rounded-full transition-colors hover:bg-gray-100">
                    <i data-lucide="x" class="text-gray-600"></i>
                </button>
            </div>
            <div id="cart-items" class="p-4 flex-grow overflow-y-auto"></div>
            <div class="p-4 border-t bg-gray-50">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-lg font-semibold">Total</span>
                    <span id="cart-total" class="text-lg font-bold">R$ 0,00</span>
                </div>
                <button id="checkout-button" class="w-full bg-orange-500 text-white py-3 rounded-lg font-semibold hover:bg-orange-600 transition disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                    Finalizar Compra
                    <i data-lucide="arrow-right" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-green-500 text-white py-2 px-5 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300"></div>

    <!-- Floating Action Buttons -->
    <div class="fixed bottom-4 right-4 z-50 flex flex-col items-center gap-3">
        <!-- Instagram Button -->
        <a href="https://www.instagram.com/danarafoods?utm_source=qr&igsh=ZW1pN3lqbXpqOXVl" target="_blank" class="w-14 h-14 rounded-full shadow-lg flex items-center justify-center bg-gradient-to-br from-purple-400 via-pink-500 to-orange-500 text-white transition-transform hover:scale-110" aria-label="Nosso Instagram">
            <i data-lucide="instagram" class="w-7 h-7"></i>
        </a>
        <!-- WhatsApp Button -->
        <a href="https://wa.me/5567992369526?text=Olá!%20Gostaria%20de%20fazer%20um%20pedido." target="_blank" class="w-14 h-14 bg-green-500 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-green-600 transition-transform hover:scale-110" aria-label="Peça pelo WhatsApp">
            <svg viewBox="0 0 32 32" class="w-8 h-8" fill="white" xmlns="http://www.w3.org/2000/svg"><path d=" M19.11 17.205c-.372 0-1.088 1.39-1.518 1.39a.63.63 0 0 1-.315-.1c-.802-.402-1.504-.817-2.163-1.447-.545-.516-1.146-1.29-1.46-1.963a.426.426 0 0 1-.073-.215c0-.33.99-.945.99-1.49 0-.143-.73-2.09-.832-2.335-.143-.372-.214-.487-.6-.487-.187 0-.36-.044-.53-.044-.302 0-.53.115-.746.315-.688.645-1.032 1.318-1.06 2.264v.114c-.015.99.472 1.977 1.017 2.78 1.23 1.82 2.506 3.41 4.554 4.34.616.287 2.035.888 2.722.888.817 0 2.15-.515 2.478-1.318.ડ02.214-.73.214-1.064v-.1c.004-.372-.128-.688-.214-.746-.088-.088-.624-.402-.69-.402z M16 0C7.163 0 0 7.163 0 16s7.163 16 16 16 16-7.163 16-16S24.837 0 16 0zm0 29C8.82 29 3 23.18 3 16S8.82 3 16 3s13 5.82 13 13-5.82 13-13 13z"></path></svg>
        </a>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // 1. IMPORT FIREBASE SERVICES
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, addDoc, setDoc, deleteDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";
    
        // 2. YOUR FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyA6kWt6KgT1zhRcY68-tExu4ZeqqmF9xhg",
            authDomain: "danarafoods.firebaseapp.com",
            projectId: "danarafoods",
            storageBucket: "danarafoods.firebasestorage.app",
            messagingSenderId: "670145100782",
            appId: "1:670145100782:web:7eabb86f092bb241cd6cff",
            measurementId: "G-HS1NJ9CLFV"
        };

        // --- GLOBAL STATE ---
        let products = [];
        let categories = [];
        let deliveryFee = 5.00;
        let logoUrl = null;
        let cart = [];
        let editingProductId = null;
        let actionToConfirm = null;
        
        // --- FIREBASE INITIALIZATION ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // --- DOM SELECTORS ---
        const dom = {
            appLoader: document.getElementById('app-loader'),
            app: document.getElementById('app'),
            productGrid: document.getElementById('product-grid'),
            categoriesContainer: document.getElementById('categories'),
            cartCount: document.getElementById('cart-count'),
            cartModal: document.getElementById('cart-modal'),
            cartItemsContainer: document.getElementById('cart-items'),
            cartTotal: document.getElementById('cart-total'),
            checkoutButton: document.getElementById('checkout-button'),
            headerTextLogo: document.getElementById('header-text-logo'),
            headerImageLogo: document.getElementById('header-image-logo'),
            heroLogoImage: document.getElementById('hero-logo-image'),
            views: {
                menu: document.getElementById('menu-section'),
                admin: document.getElementById('admin-view'),
                checkout: document.getElementById('checkout-view'),
                confirmation: document.getElementById('order-confirmation-view'),
                hero: document.getElementById('hero'),
                infoServices: document.getElementById('info-services-view'),
                infoPayments: document.getElementById('info-payments-view')
            },
            admin: {
                productList: document.getElementById('admin-product-list'),
                form: document.getElementById('product-form'),
                formTitle: document.getElementById('form-title'),
                productIdInput: document.getElementById('product-id'),
                productNameInput: document.getElementById('product-name'),
                productDescInput: document.getElementById('product-description'),
                productPriceInput: document.getElementById('product-price'),
                productCategoryInput: document.getElementById('product-category'),
                productImageInput: document.getElementById('product-image'),
                productImageUrlInput: document.getElementById('product-image-url'),
                imagePreview: document.getElementById('image-preview'),
                saveButton: document.getElementById('save-product-button'),
                saveButtonText: document.getElementById('save-product-text'),
                saveButtonLoader: document.getElementById('save-product-loader'),
                cancelEditButton: document.getElementById('cancel-edit-button'),
                categoryForm: document.getElementById('category-form'),
                categoryNameInput: document.getElementById('category-name'),
                adminCategoryList: document.getElementById('admin-category-list'),
                logoUploadInput: document.getElementById('logo-upload'),
                logoPreview: document.getElementById('logo-preview'),
                saveLogoButton: document.getElementById('save-logo-button'),
            },
            settingsForm: document.getElementById('settings-form'),
            deliveryFeeInput: document.getElementById('delivery-fee'),
            confirmationModal: {
                modal: document.getElementById('confirmation-modal'),
                confirmButton: document.getElementById('confirm-action-button'),
                cancelButton: document.getElementById('cancel-confirmation-button')
            },
            toast: document.getElementById('toast')
        };
        
        // --- UTILITY FUNCTIONS ---
        const formatCurrency = (value) => value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        const showToast = (message, type = 'success') => {
            dom.toast.textContent = message;
            dom.toast.className = `fixed bottom-5 right-5 text-white py-2 px-5 rounded-lg shadow-lg transform transition-all duration-300 ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
            dom.toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => { dom.toast.classList.add('translate-y-20', 'opacity-0'); }, 3000);
        };
        const switchView = (viewName) => {
            Object.values(dom.views).forEach(v => v.classList.add('hidden'));
            if (viewName === 'menu') {
                dom.views.hero.classList.remove('hidden');
                dom.views.infoServices.classList.remove('hidden');
                dom.views.infoPayments.classList.remove('hidden');
                dom.views.menu.classList.remove('hidden');
            } else if (dom.views[viewName]) {
                dom.views[viewName].classList.remove('hidden');
            }
            window.scrollTo(0, 0);
        };

        // --- RENDER FUNCTIONS ---
        const renderLogos = () => {
            if (logoUrl) {
                // Header logo
                dom.headerImageLogo.src = logoUrl;
                dom.headerImageLogo.classList.remove('hidden');
                dom.headerTextLogo.classList.add('hidden');
                // Admin preview logo
                dom.admin.logoPreview.src = logoUrl;
                // Hero logo
                dom.heroLogoImage.src = logoUrl;
                dom.heroLogoImage.classList.remove('hidden');
            } else {
                // Header logo
                dom.headerImageLogo.classList.add('hidden');
                dom.headerTextLogo.classList.remove('hidden');
                // Admin preview logo
                dom.admin.logoPreview.src = "https://placehold.co/100x100/f97316/ffffff?text=Logo";
                // Hero logo
                dom.heroLogoImage.classList.add('hidden');
            }
        };

        const renderProducts = (categoryFilter = 'todos') => {
            dom.productGrid.innerHTML = '';
            const filtered = categoryFilter === 'todos' ? products : products.filter(p => p.category === categoryFilter);
            if (filtered.length === 0) {
                dom.productGrid.innerHTML = `<p class="text-gray-500 col-span-full">Nenhum produto encontrado nesta categoria.</p>`;
                return;
            }
            filtered.forEach(p => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-md overflow-hidden transform hover:-translate-y-1 transition-transform duration-300 flex flex-col group';
                card.innerHTML = `
                    <div class="w-full h-48 bg-gray-100 flex items-center justify-center overflow-hidden">
                        <img src="${p.image}" alt="${p.name}" class="w-full h-full object-contain transition-transform duration-300 group-hover:scale-105">
                    </div>
                    <div class="p-4 flex-grow flex flex-col">
                        <h3 class="text-lg font-bold">${p.name}</h3>
                        <p class="text-gray-600 text-sm mt-1 mb-4 flex-grow">${p.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-orange-500">${formatCurrency(p.price)}</span>
                            <button class="add-to-cart-btn bg-orange-100 text-orange-600 font-bold p-2 rounded-full hover:bg-orange-200 transition" data-id="${p.id}"><i data-lucide="plus" class="w-5 h-5"></i></button>
                        </div>
                    </div>`;
                dom.productGrid.appendChild(card);
            });
            lucide.createIcons();
        };
        
        const renderCategories = () => {
            const currentCategoryEl = document.querySelector('.category-btn.bg-orange-500');
            const currentCategory = currentCategoryEl ? currentCategoryEl.dataset.category : 'todos';

            const filterContainer = dom.categoriesContainer;
            filterContainer.innerHTML = `<button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap border" data-category="todos">Todos</button>`;
            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = "category-btn bg-white text-gray-700 px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap border";
                btn.dataset.category = cat.name.toLowerCase().replace(/\s+/g, '-');
                btn.textContent = cat.name;
                filterContainer.appendChild(btn);
            });
            
            const activeBtn = document.querySelector(`.category-btn[data-category="${currentCategory}"]`);
            if (activeBtn) {
                 document.querySelectorAll('.category-btn').forEach(b => {
                    b.classList.remove('bg-orange-500', 'text-white');
                    b.classList.add('bg-white', 'text-gray-700');
                });
                activeBtn.classList.add('bg-orange-500', 'text-white');
                activeBtn.classList.remove('bg-white', 'text-gray-700');
            }


            const selectContainer = dom.admin.productCategoryInput;
            selectContainer.innerHTML = '';
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.name.toLowerCase().replace(/\s+/g, '-');
                option.textContent = cat.name;
                selectContainer.appendChild(option);
            });

            const listContainer = dom.admin.adminCategoryList;
            listContainer.innerHTML = '';
            categories.forEach(cat => {
                const item = document.createElement('div');
                item.className = 'bg-gray-100 p-2 rounded-md flex justify-between items-center';
                item.innerHTML = `
                    <span class="font-medium">${cat.name}</span>
                    <button class="delete-category-btn p-1 text-red-500 hover:bg-red-100 rounded-full" data-id="${cat.id}"><i data-lucide="trash-2" class="w-4 h-4"></i></button>`;
                listContainer.appendChild(item);
            });
            lucide.createIcons();
        };

        const renderCart = () => {
             dom.cartItemsContainer.innerHTML = '';
            let total = 0;
            if (cart.length === 0) {
                dom.cartItemsContainer.innerHTML = `<div class="flex flex-col items-center justify-center h-full text-center text-gray-500"><i data-lucide="shopping-basket" class="w-16 h-16 mb-4 text-gray-300"></i><h3 class="text-lg font-semibold">Seu carrinho está vazio</h3></div>`;
            } else {
                cart.forEach(item => {
                    total += item.price * item.quantity;
                    const cartItem = document.createElement('div');
                    cartItem.className = 'flex gap-4 py-4 border-b';
                    cartItem.innerHTML = `
                        <img src="${item.image}" alt="${item.name}" class="w-20 h-20 object-contain bg-gray-100 rounded-lg">
                        <div class="flex flex-col justify-between flex-grow">
                            <div><p class="font-semibold leading-tight">${item.name}</p><p class="text-sm text-orange-500 font-bold">${formatCurrency(item.price)}</p></div>
                            <div class="flex items-center justify-between mt-2">
                                <div class="flex items-center gap-2">
                                    <button class="cart-quantity-btn w-7 h-7 flex items-center justify-center bg-gray-100 rounded-full" data-id="${item.id}" data-action="decrease"><i data-lucide="minus" class="w-4 h-4"></i></button>
                                    <span class="font-bold w-6 text-center">${item.quantity}</span>
                                    <button class="cart-quantity-btn w-7 h-7 flex items-center justify-center bg-gray-100 rounded-full" data-id="${item.id}" data-action="increase"><i data-lucide="plus" class="w-4 h-4"></i></button>
                                </div>
                                <button class="cart-remove-btn p-1" data-id="${item.id}"><i data-lucide="trash-2" class="w-5 h-5 text-gray-400 hover:text-red-500"></i></button>
                            </div>
                        </div>`;
                    dom.cartItemsContainer.appendChild(cartItem);
                });
            }
            dom.cartTotal.textContent = formatCurrency(total);
            dom.cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
            dom.checkoutButton.disabled = cart.length === 0;
            lucide.createIcons();
        };

        const renderAdminProducts = () => {
            dom.admin.productList.innerHTML = '';
            products.forEach(p => {
                const item = document.createElement('div');
                item.className = 'bg-white p-4 rounded-lg shadow-sm flex items-center justify-between';
                item.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <img src="${p.image}" alt="${p.name}" class="w-16 h-16 object-contain bg-gray-100 rounded-md">
                        <div><p class="font-bold">${p.name}</p><p class="text-sm text-gray-500">${formatCurrency(p.price)}</p></div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="edit-product-btn p-2 text-blue-600 hover:bg-blue-100 rounded-full" data-id="${p.id}"><i data-lucide="file-pen-line"></i></button>
                        <button class="delete-product-btn p-2 text-red-600 hover:bg-red-100 rounded-full" data-id="${p.id}"><i data-lucide="trash-2"></i></button>
                    </div>`;
                dom.admin.productList.appendChild(item);
            });
            lucide.createIcons();
        };

        // --- CART LOGIC ---
        const addToCart = (productId) => {
            const product = products.find(p => p.id === productId);
            const cartItem = cart.find(item => item.id === productId);
            if (cartItem) cartItem.quantity++;
            else cart.push({ ...product, quantity: 1 });
            showToast(`${product.name} adicionado!`);
            renderCart();
        };
        const updateCartQuantity = (productId, action) => {
            const cartItem = cart.find(item => item.id === productId);
            if (!cartItem) return;
            if (action === 'increase') cartItem.quantity++;
            else if (action === 'decrease') {
                cartItem.quantity--;
                if (cartItem.quantity === 0) cart = cart.filter(item => item.id !== productId);
            }
            renderCart();
        };

        // --- MAIN INITIALIZATION ---
        async function main() {
            try {
                await signInAnonymously(auth);
            } catch (error) {
                console.error("Firebase Auth Error:", error);
                if (error.code === 'auth/api-key-not-valid') {
                    alert("Erro de configuração do Firebase: A chave da API não é válida. Por favor, verifique sua configuração no arquivo index.html.");
                }
                return;
            }
            
            lucide.createIcons();
            setupEventListeners();
            
            // Real-time listeners
            onSnapshot(query(collection(db, "products"), orderBy("createdAt", "desc")), (snapshot) => {
                products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderProducts();
                renderAdminProducts();
                dom.appLoader.style.display = 'none';
                dom.app.classList.remove('hidden');
            });
            onSnapshot(doc(db, "settings", "delivery"), (doc) => {
                if (doc.exists()) {
                    deliveryFee = doc.data().fee;
                    dom.deliveryFeeInput.value = deliveryFee.toFixed(2);
                }
            });
             onSnapshot(doc(db, "settings", "logo"), (doc) => {
                logoUrl = doc.exists() ? doc.data().url : null;
                renderLogos();
            });
            onSnapshot(query(collection(db, "categories"), orderBy("name")), (snapshot) => {
                categories = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderCategories();
            });
        }

        function setupEventListeners() {
            // Navigation
            document.getElementById('home-button').addEventListener('click', () => switchView('menu'));
            document.getElementById('admin-nav-button').addEventListener('click', () => switchView('admin'));
            document.getElementById('menu-nav-button').addEventListener('click', () => switchView('menu'));
            document.getElementById('back-to-menu-button').addEventListener('click', () => switchView('menu'));
            document.getElementById('new-order-button').addEventListener('click', () => switchView('menu'));
            
            // Product Grid & Categories
            dom.productGrid.addEventListener('click', e => {
                const btn = e.target.closest('.add-to-cart-btn');
                if(btn) addToCart(btn.dataset.id);
            });
            dom.categoriesContainer.addEventListener('click', e => {
                const btn = e.target.closest('.category-btn');
                if (btn) {
                    document.querySelectorAll('.category-btn').forEach(b => {
                        b.classList.remove('bg-orange-500', 'text-white');
                        b.classList.add('bg-white', 'text-gray-700');
                    });
                    btn.classList.remove('bg-white', 'text-gray-700');
                    btn.classList.add('bg-orange-500', 'text-white');
                    renderProducts(btn.dataset.category);
                }
            });

            // Cart
            const cartPanel = dom.cartModal.querySelector('div.bg-white');
            const closeCart = () => {
                dom.cartModal.classList.add('opacity-0');
                cartPanel.classList.add('translate-x-full');
                setTimeout(() => dom.cartModal.classList.add('invisible'), 300);
            };
            document.getElementById('cart-button').addEventListener('click', () => {
                dom.cartModal.classList.remove('invisible', 'opacity-0');
                cartPanel.classList.remove('translate-x-full');
            });
            document.getElementById('close-cart-button').addEventListener('click', closeCart);
            dom.cartModal.addEventListener('click', e => { if (e.target.id === 'cart-modal') closeCart(); });
            dom.cartItemsContainer.addEventListener('click', e => {
                const qBtn = e.target.closest('.cart-quantity-btn');
                const rBtn = e.target.closest('.cart-remove-btn');
                if (qBtn) updateCartQuantity(qBtn.dataset.id, qBtn.dataset.action);
                if (rBtn) { cart = cart.filter(item => item.id !== rBtn.dataset.id); renderCart(); }
            });
            dom.checkoutButton.addEventListener('click', () => {
                if (cart.length > 0) {
                    switchView('checkout');
                    closeCart();
                    renderCheckoutSummary();
                }
            });
            
            // Admin Form
            dom.admin.form.addEventListener('submit', handleAdminFormSubmit);
            dom.admin.cancelEditButton.addEventListener('click', resetAdminForm);
            dom.admin.productList.addEventListener('click', handleAdminListClick);
            dom.admin.categoryForm.addEventListener('submit', handleCategoryFormSubmit);
            dom.admin.adminCategoryList.addEventListener('click', handleDeleteCategoryClick);
            dom.settingsForm.addEventListener('submit', handleSettingsFormSubmit);
            dom.admin.productImageInput.addEventListener('change', e => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = e => {
                        dom.admin.imagePreview.src = e.target.result;
                        dom.admin.imagePreview.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });
            dom.admin.logoUploadInput.addEventListener('change', handleLogoPreview);
            dom.admin.saveLogoButton.addEventListener('click', handleSaveLogo);
            
            // Other Listeners
            document.getElementById('place-order-button').addEventListener('click', handlePlaceOrder);
            document.getElementById('customer-cep').addEventListener('blur', handleCepLookup);
            document.getElementById('payment-method').addEventListener('change', e => {
                const changeContainer = document.getElementById('change-container');
                if (e.target.value === 'Dinheiro') changeContainer.classList.remove('hidden');
                else changeContainer.classList.add('hidden');
            });

            // Confirmation Modal
            dom.confirmationModal.cancelButton.addEventListener('click', () => {
                dom.confirmationModal.modal.classList.add('hidden');
                actionToConfirm = null;
            });
            dom.confirmationModal.confirmButton.addEventListener('click', () => {
                if (typeof actionToConfirm === 'function') actionToConfirm();
                dom.confirmationModal.modal.classList.add('hidden');
                actionToConfirm = null;
            });
        }
        
        // --- EVENT HANDLERS ---
        async function handleAdminFormSubmit(e) {
            e.preventDefault();
            if (categories.length === 0) {
                showToast('Adicione uma categoria primeiro!', 'error');
                return;
            }
            const { saveButton, saveButtonText, saveButtonLoader, productImageInput, productImageUrlInput } = dom.admin;
            saveButtonText.textContent = editingProductId ? 'Atualizando...' : 'Salvando...';
            saveButtonLoader.classList.remove('hidden');
            saveButton.disabled = true;

            const imageFile = productImageInput.files[0];
            let imageUrl = productImageUrlInput.value;
            if (imageFile) {
                const storageRef = ref(storage, `products/${Date.now()}-${imageFile.name}`);
                await uploadBytes(storageRef, imageFile);
                imageUrl = await getDownloadURL(storageRef);
            }

            const productData = {
                name: dom.admin.productNameInput.value,
                description: dom.admin.productDescInput.value,
                price: parseFloat(dom.admin.productPriceInput.value),
                category: dom.admin.productCategoryInput.value,
                image: imageUrl,
                createdAt: serverTimestamp()
            };

            try {
                if (editingProductId) {
                    await setDoc(doc(db, "products", editingProductId), productData);
                    showToast('Produto atualizado!');
                } else {
                    await addDoc(collection(db, "products"), productData);
                    showToast('Produto adicionado!');
                }
            } catch (error) {
                showToast('Erro ao salvar produto.', 'error');
                console.error("Firestore Error: ", error);
            } finally {
                resetAdminForm();
                saveButtonText.textContent = 'Salvar Produto';
                saveButtonLoader.classList.add('hidden');
                saveButton.disabled = false;
            }
        }
        
        async function handleCategoryFormSubmit(e) {
            e.preventDefault();
            const newCategoryName = dom.admin.categoryNameInput.value.trim();
            if (newCategoryName) {
                try {
                    await addDoc(collection(db, "categories"), { name: newCategoryName });
                    showToast('Categoria adicionada!');
                    dom.admin.categoryForm.reset();
                } catch(error) {
                    showToast('Erro ao adicionar categoria.', 'error');
                }
            }
        }

        function handleLogoPreview(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => { dom.admin.logoPreview.src = event.target.result; };
                reader.readAsDataURL(file);
            }
        }

        async function handleSaveLogo() {
            const file = dom.admin.logoUploadInput.files[0];
            if (!file) {
                showToast('Selecione um arquivo de imagem primeiro.', 'error');
                return;
            }
            dom.admin.saveLogoButton.textContent = 'Enviando...';
            dom.admin.saveLogoButton.disabled = true;
            try {
                const storageRef = ref(storage, `settings/logo-${Date.now()}`);
                await uploadBytes(storageRef, file);
                const newLogoUrl = await getDownloadURL(storageRef);
                await setDoc(doc(db, "settings", "logo"), { url: newLogoUrl });
                showToast('Logo atualizada com sucesso!');
            } catch (error) {
                console.error("Logo Upload Error:", error);
                showToast('Erro ao enviar a logo.', 'error');
            } finally {
                dom.admin.saveLogoButton.textContent = 'Salvar Logo';
                dom.admin.saveLogoButton.disabled = false;
            }
        }
        
        function handleDeleteCategoryClick(e) {
            const deleteBtn = e.target.closest('.delete-category-btn');
            if (deleteBtn) {
                const id = deleteBtn.dataset.id;
                const categoryName = categories.find(c => c.id === id)?.name || '';
                
                actionToConfirm = async () => {
                    try {
                        // Optional: Check if products use this category before deleting
                        await deleteDoc(doc(db, "categories", id));
                        showToast(`Categoria "${categoryName}" excluída!`, 'error');
                    } catch (error) {
                        showToast('Erro ao excluir categoria.', 'error');
                    }
                };
                
                const confirmationMessage = document.getElementById('confirmation-message');
                confirmationMessage.textContent = `Tem certeza que deseja excluir a categoria "${categoryName}"? Isso não removerá os produtos já existentes nesta categoria.`;
                dom.confirmationModal.modal.classList.remove('hidden');
            }
        }

        async function handleSettingsFormSubmit(e) {
            e.preventDefault();
            const newFee = parseFloat(dom.deliveryFeeInput.value);
            if (!isNaN(newFee) && newFee >= 0) {
                await setDoc(doc(db, "settings", "delivery"), { fee: newFee });
                showToast('Taxa de entrega atualizada!');
            }
        }
        
        function handleAdminListClick(e) {
            const editBtn = e.target.closest('.edit-product-btn');
            const deleteBtn = e.target.closest('.delete-product-btn');

            if (editBtn) {
                const id = editBtn.dataset.id;
                const p = products.find(prod => prod.id === id);
                editingProductId = id;
                dom.admin.productNameInput.value = p.name;
                dom.admin.productDescInput.value = p.description;
                dom.admin.productPriceInput.value = p.price;
                dom.admin.productCategoryInput.value = p.category;
                dom.admin.productImageUrlInput.value = p.image;
                dom.admin.imagePreview.src = p.image;
                dom.admin.imagePreview.classList.remove('hidden');
                dom.admin.formTitle.textContent = 'Editar Produto';
                dom.admin.saveButtonText.textContent = 'Atualizar Produto';
                dom.admin.cancelEditButton.classList.remove('hidden');
                dom.views.admin.scrollIntoView({ behavior: 'smooth' });
            }

            if (deleteBtn) {
                const id = deleteBtn.dataset.id;
                actionToConfirm = async () => {
                    try {
                        const productToDelete = products.find(p => p.id === id);
                        if (productToDelete && productToDelete.image.includes('firebasestorage')) {
                            const imageRef = ref(storage, productToDelete.image);
                            await deleteObject(imageRef);
                        }
                        await deleteDoc(doc(db, "products", id));
                        showToast('Produto excluído!', 'error');
                    } catch (error) {
                        showToast('Erro ao excluir produto.', 'error');
                        console.error("Deletion Error:", error);
                    }
                };
                const confirmationMessage = document.getElementById('confirmation-message');
                confirmationMessage.textContent = 'Tem certeza que deseja excluir este produto?';
                dom.confirmationModal.modal.classList.remove('hidden');
            }
        }

        function resetAdminForm() {
            dom.admin.form.reset();
            dom.admin.imagePreview.classList.add('hidden');
            dom.admin.imagePreview.src = '';
            editingProductId = null;
            dom.admin.formTitle.textContent = 'Adicionar Novo Produto';
            dom.admin.saveButtonText.textContent = 'Salvar Produto';
            dom.admin.cancelEditButton.classList.add('hidden');
        }

        function handlePlaceOrder() {
             const form = document.getElementById('checkout-form');
             if (form.checkValidity()) {
                const changeForValue = document.getElementById('change-for').value;
                const fullAddress = `${document.getElementById('customer-street').value}, ${document.getElementById('customer-number').value}, ${document.getElementById('customer-complement').value ? '(' + document.getElementById('customer-complement').value + ')' : ''} - ${document.getElementById('customer-neighborhood').value}, ${document.getElementById('customer-city').value} - ${document.getElementById('customer-state').value}`;

                const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                const total = subtotal + deliveryFee;

                const orderDetails = {
                    customer: document.getElementById('customer-name').value,
                    address: fullAddress,
                    phone: document.getElementById('customer-phone').value,
                    paymentMethod: document.querySelector('input[name="payment"]:checked').value,
                    items: cart,
                    subtotal: subtotal,
                    deliveryFee: deliveryFee,
                    total: total,
                    date: new Date(),
                    changeFor: changeForValue ? parseFloat(changeForValue) : null
                };
                
                const phoneNumber = '5567992369526';
                let message = `*Novo Pedido - DANARAFOODS*\n\n`;
                message += `*Cliente:* ${orderDetails.customer}\n`;
                message += `*Telefone:* ${orderDetails.phone}\n`;
                message += `*Endereço:* ${orderDetails.address}\n\n`;
                message += `*ITENS DO PEDIDO:*\n`;
                orderDetails.items.forEach(item => {
                    message += `• ${item.quantity}x ${item.name} - ${formatCurrency(item.price * item.quantity)}\n`;
                });
                message += `\n*Subtotal:* ${formatCurrency(orderDetails.subtotal)}\n`;
                message += `*Taxa de Entrega:* ${formatCurrency(orderDetails.deliveryFee)}\n`;
                message += `*Total:* *${formatCurrency(orderDetails.total)}*\n\n`;
                message += `*Forma de Pagamento:* ${orderDetails.paymentMethod}\n`;

                if (orderDetails.paymentMethod === 'Dinheiro' && orderDetails.changeFor && orderDetails.changeFor > orderDetails.total) {
                    const changeAmount = orderDetails.changeFor - orderDetails.total;
                    message += `*Troco para:* ${formatCurrency(orderDetails.changeFor)} (Levar ${formatCurrency(changeAmount)})`;
                }

                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
                
                window.open(whatsappUrl, '_blank');
                
                displayOrderConfirmation(orderDetails);
                cart = [];
                renderCart();
                form.reset();
                switchView('confirmation');
             } else {
                 form.reportValidity();
             }
        }
        
        async function handleCepLookup(e) {
            const cep = e.target.value.replace(/\D/g, '');
            if (cep.length !== 8) return;
            
            const loader = document.getElementById('cep-loader');
            const inputs = {
                street: document.getElementById('customer-street'),
                neighborhood: document.getElementById('customer-neighborhood'),
                city: document.getElementById('customer-city'),
                state: document.getElementById('customer-state'),
            };
            
            loader.classList.remove('hidden');
            Object.values(inputs).forEach(input => {
                input.value = '...';
                input.classList.add('bg-gray-100');
            });
            
            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();
                if (data.erro) throw new Error("CEP não encontrado");
                
                inputs.street.value = data.logradouro;
                inputs.neighborhood.value = data.bairro;
                inputs.city.value = data.localidade;
                inputs.state.value = data.uf;
                document.getElementById('customer-number').focus();
            } catch (error) {
                console.error("CEP Error:", error);
                Object.values(inputs).forEach(input => {
                    input.value = '';
                    input.readOnly = false;
                    input.classList.remove('bg-gray-100');
                });
            } finally {
                loader.classList.add('hidden');
            }
        }

        function renderCheckoutSummary() {
            const summaryContainer = document.getElementById('checkout-summary');
            const totalContainer = document.getElementById('checkout-total');
            const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            
            const itemsHtml = cart.map(item => `<div class="flex justify-between text-sm"><span>${item.quantity}x ${item.name}</span><span>${formatCurrency(item.price * item.quantity)}</span></div>`).join('');
            
            summaryContainer.innerHTML = `<div class="space-y-2">${itemsHtml}</div><div class="border-t my-2"></div><div class="flex justify-between"><span>Subtotal</span><span>${formatCurrency(subtotal)}</span></div><div class="flex justify-between"><span>Taxa de Entrega</span><span>${formatCurrency(deliveryFee)}</span></div>`;
            totalContainer.textContent = formatCurrency(subtotal + deliveryFee);
        };
        
        const displayOrderConfirmation = (order) => {
            const container = document.getElementById('confirmation-details');
            const itemsHtml = order.items.map(item => `<div class="flex justify-between text-sm"><span>${item.quantity}x ${item.name}</span><span>${formatCurrency(item.price * item.quantity)}</span></div>`).join('');
            let changeInfoHtml = '';
            if (order.paymentMethod === 'Dinheiro' && order.changeFor && order.changeFor > order.total) {
                const changeAmount = order.changeFor - order.total;
                changeInfoHtml = `<p class="mb-3"><strong>Troco para:</strong> ${formatCurrency(order.changeFor)} (Levar ${formatCurrency(changeAmount)})</p>`;
            }
            container.innerHTML = `<p class="mb-2"><strong>Cliente:</strong> ${order.customer}</p><p class="mb-2"><strong>Endereço:</strong> ${order.address}</p><p class="mb-2"><strong>Data:</strong> ${order.date.toLocaleString('pt-BR')}</p><p class="mb-3"><strong>Pagamento:</strong> ${order.paymentMethod}</p>${changeInfoHtml}<div class="border-t pt-3 space-y-1">${itemsHtml}</div><div class="flex justify-between text-sm mt-2 pt-2 border-t"><span>Taxa de Entrega</span><span>${formatCurrency(order.deliveryFee)}</span></div><div class="flex justify-between font-bold text-lg mt-3 border-t pt-2"><span>Total:</span><span>${formatCurrency(order.total)}</span></div>`;
        };
        // --- START THE APP ---
        main();

    </script>

</body>
</html>


